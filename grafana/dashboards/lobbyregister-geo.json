{
  "annotations": {
    "list": []
  },
  "editable": true,
  "fiscalYearStartMonth": 0,
  "graphTooltip": 0,
  "links": [],
  "liveNow": false,
  "panels": [
    {
      "datasource": {
        "type": "postgres",
        "uid": "${datasource}"
      },
      "gridPos": {
        "h": 12,
        "w": 14,
        "x": 0,
        "y": 0
      },
      "id": 1,
      "options": {
        "basemap": {
          "config": {},
          "name": "Layer 0",
          "type": "default"
        },
        "controls": {
          "mouseWheelZoom": true,
          "showAttribution": true,
          "showDebug": false,
          "showMeasure": false,
          "showScale": false,
          "showZoom": true
        },
        "layers": [
          {
            "config": {
              "showLegend": true,
              "style": {
                "color": {
                  "field": "Anzahl",
                  "fixed": "dark-green"
                },
                "opacity": 0.4,
                "rotation": {
                  "fixed": 0,
                  "mode": "mod"
                },
                "size": {
                  "field": "Anzahl",
                  "fixed": 5,
                  "max": 15,
                  "min": 2
                },
                "symbol": {
                  "fixed": "img/icons/marker/circle.svg",
                  "mode": "fixed"
                },
                "text": {
                  "field": "Land",
                  "fixed": "",
                  "mode": "fixed"
                }
              }
            },
            "location": {
              "lookup": "Land",
              "mode": "lookup"
            },
            "name": "Layer 1",
            "tooltip": true,
            "type": "markers"
          }
        ],
        "tooltip": {
          "mode": "details"
        },
        "view": {
          "id": "europe",
          "lat": 46,
          "lon": 14,
          "zoom": 4
        }
      },
      "targets": [
        {
          "format": "table",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "SELECT \n  cl.code as \"Land\", \n  COUNT(DISTINCT re.id) as \"Anzahl\"\nFROM register_entry re\nJOIN lobbyist_identity li ON re.id = li.entry_id\nJOIN address a ON li.address_id = a.id\nJOIN country_label cl ON a.country_id = cl.id\nWHERE cl.code != 'DE' -- Nur Ausland\nGROUP BY cl.code\nORDER BY 2 DESC",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "column"
              }
            ]
          ],
          "table": "activities_interests",
          "timeColumn": "time",
          "timeColumnType": "timestamp",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Internationale Lobby-Aktivitäten (außer DE)",
      "type": "geomap"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "${datasource}"
      },
      "gridPos": {
        "h": 12,
        "w": 10,
        "x": 14,
        "y": 0
      },
      "id": 2,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "targets": [
        {
          "format": "table",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "SELECT \n  SUBSTRING(a.zip_code, 1, 1) || 'xxxx' as \"PLZ-Region\",\n  COUNT(DISTINCT re.id) as \"Anzahl Organisationen\"\nFROM register_entry re\nJOIN lobbyist_identity li ON re.id = li.entry_id\nJOIN address a ON li.address_id = a.id\nJOIN country_label cl ON a.country_id = cl.id\nWHERE cl.code = 'DE' AND a.zip_code IS NOT NULL\nGROUP BY SUBSTRING(a.zip_code, 1, 1)\nORDER BY 1 ASC",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "column"
              }
            ]
          ],
          "table": "activities_interests",
          "timeColumn": "time",
          "timeColumnType": "timestamp",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Verteilung nach PLZ-Regionen (Deutschland)",
      "type": "barchart"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "${datasource}"
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 0,
        "y": 12
      },
      "id": 3,
      "options": {
        "footer": {
          "fields": "",
          "reducer": [
            "sum"
          ],
          "show": false
        },
        "showHeader": true
      },
      "targets": [
        {
          "format": "table",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "SELECT \n  a.city as \"Stadt\", \n  COUNT(DISTINCT re.id) as \"Anzahl Organisationen\",\n  SUM(fe.expenses_to_eur) as \"Finanzvolumen Total\"\nFROM register_entry re\nJOIN lobbyist_identity li ON re.id = li.entry_id\nJOIN address a ON li.address_id = a.id\nLEFT JOIN financial_expenses fe ON re.id = fe.entry_id\nGROUP BY a.city\nORDER BY 2 DESC\nLIMIT 20",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "column"
              }
            ]
          ],
          "table": "activities_interests",
          "timeColumn": "time",
          "timeColumnType": "timestamp",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Top Lobby-Städte (Ranking)",
      "type": "table"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "${datasource}"
      },
      "gridPos": {
        "h": 8,
        "w": 12,
        "x": 12,
        "y": 12
      },
      "id": 4,
      "options": {
        "colorMode": "value",
        "graphMode": "area",
        "justifyMode": "auto",
        "orientation": "auto",
        "reduceOptions": {
          "calcs": [
            "lastNotNull"
          ],
          "fields": "",
          "values": false
        },
        "textMode": "auto",
        "wideLayout": true
      },
      "pluginVersion": "10.0.0",
      "targets": [
        {
          "format": "table",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "SELECT \n  (SELECT COUNT(DISTINCT re.id) FROM register_entry re JOIN lobbyist_identity li ON re.id = li.entry_id JOIN address a ON li.address_id = a.id JOIN country_label cl ON a.country_id = cl.id WHERE cl.code = 'DE') as \"Deutschland\",\n  (SELECT COUNT(DISTINCT re.id) FROM register_entry re JOIN lobbyist_identity li ON re.id = li.entry_id JOIN address a ON li.address_id = a.id JOIN country_label cl ON a.country_id = cl.id WHERE cl.code != 'DE') as \"International\"",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "column"
              }
            ]
          ],
          "table": "activities_interests",
          "timeColumn": "time",
          "timeColumnType": "timestamp",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Verhältnis Inland vs. Ausland",
      "type": "stat"
    },
    {
      "datasource": {
        "type": "postgres",
        "uid": "${datasource}"
      },
      "gridPos": {
        "h": 8,
        "w": 24,
        "x": 0,
        "y": 20
      },
      "id": 5,
      "options": {
        "legend": {
          "calcs": [],
          "displayMode": "list",
          "placement": "bottom",
          "showLegend": true
        },
        "tooltip": {
          "mode": "single",
          "sort": "none"
        }
      },
      "targets": [
        {
          "format": "table",
          "group": [],
          "metricColumn": "none",
          "rawQuery": true,
          "rawSql": "SELECT \n  a.city as \"Stadt\",\n  AVG(fe.expenses_to_eur) as \"Durchschnittliche Ausgaben pro Firma\"\nFROM register_entry re\nJOIN lobbyist_identity li ON re.id = li.entry_id\nJOIN address a ON li.address_id = a.id\nJOIN financial_expenses fe ON re.id = fe.entry_id\nWHERE a.city IN ('Berlin', 'München', 'Hamburg', 'Frankfurt am Main', 'Düsseldorf', 'Köln', 'Stuttgart')\nGROUP BY a.city\nORDER BY 2 DESC",
          "refId": "A",
          "select": [
            [
              {
                "params": [
                  "value"
                ],
                "type": "column"
              }
            ]
          ],
          "table": "financial_expenses",
          "timeColumn": "time",
          "timeColumnType": "timestamp",
          "where": [
            {
              "name": "$__timeFilter",
              "params": [],
              "type": "macro"
            }
          ]
        }
      ],
      "title": "Teures Pflaster? (Durchschnittsausgaben pro Stadt)",
      "type": "barchart"
    }
  ],
  "refresh": "",
  "schemaVersion": 38,
  "style": "dark",
  "tags": ["portfolio-4"],
  "templating": {
    "list": [
      {
        "current": {
          "selected": false,
          "text": "PostgreSQL",
          "value": "PostgreSQL"
        },
        "hide": 0,
        "includeAll": false,
        "label": "Datasource",
        "multi": false,
        "name": "datasource",
        "options": [],
        "query": "postgres",
        "refresh": 1,
        "regex": "",
        "skipUrlSync": false,
        "type": "datasource"
      }
    ]
  },
  "time": {
    "from": "now-6h",
    "to": "now"
  },
  "timepicker": {},
  "timezone": "",
  "title": "Lobbyregister - Geographic Insights",
  "uid": "lobby_geo",
  "version": 1,
  "weekStart": ""
}